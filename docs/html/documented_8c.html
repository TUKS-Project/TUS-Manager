<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TUKS - The Ultimate Shell Manager: src/documented.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TUKS - The Ultimate Shell Manager
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">documented.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;sys/wait.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for documented.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c__incl.svg" width="846" height="110"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="documented_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structSession.html">Session</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents a managed shell session.  <a href="structSession.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1c6d5de492ac61ad29aec7aa9a436bbf" id="r_a1c6d5de492ac61ad29aec7aa9a436bbf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a1c6d5de492ac61ad29aec7aa9a436bbf">VERSION</a>&#160;&#160;&#160;&quot;1.0&quot;</td></tr>
<tr class="memdesc:a1c6d5de492ac61ad29aec7aa9a436bbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Program version string.  <br /></td></tr>
<tr class="separator:a1c6d5de492ac61ad29aec7aa9a436bbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c8fad838ed64cc67da3f68149009758" id="r_a6c8fad838ed64cc67da3f68149009758"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a6c8fad838ed64cc67da3f68149009758">AUTHOR</a>&#160;&#160;&#160;&quot;Abdullah, Abdulaziz&quot;</td></tr>
<tr class="memdesc:a6c8fad838ed64cc67da3f68149009758"><td class="mdescLeft">&#160;</td><td class="mdescRight">Author string used in banners.  <br /></td></tr>
<tr class="separator:a6c8fad838ed64cc67da3f68149009758"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41d49c9bf1512077295129c1406be4cd" id="r_a41d49c9bf1512077295129c1406be4cd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a41d49c9bf1512077295129c1406be4cd">URL</a>&#160;&#160;&#160;&quot;https://github.com/TUKS-Project/TUS-Manager&quot;</td></tr>
<tr class="memdesc:a41d49c9bf1512077295129c1406be4cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Project repository URL.  <br /></td></tr>
<tr class="separator:a41d49c9bf1512077295129c1406be4cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3ef68d2292999ee3beb635427a515ef" id="r_ad3ef68d2292999ee3beb635427a515ef"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#ad3ef68d2292999ee3beb635427a515ef">MAX_SESSIONS</a>&#160;&#160;&#160;20</td></tr>
<tr class="memdesc:ad3ef68d2292999ee3beb635427a515ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum number of concurrent sessions supported.  <br /></td></tr>
<tr class="separator:ad3ef68d2292999ee3beb635427a515ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b20d41d6252e9871430c242cb1a56e7" id="r_a6b20d41d6252e9871430c242cb1a56e7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>&#160;&#160;&#160;4096</td></tr>
<tr class="memdesc:a6b20d41d6252e9871430c242cb1a56e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generic buffer size used for IO operations.  <br /></td></tr>
<tr class="separator:a6b20d41d6252e9871430c242cb1a56e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac653f5b6dfa7a11107cdcc4e6b8c721c" id="r_ac653f5b6dfa7a11107cdcc4e6b8c721c"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#ac653f5b6dfa7a11107cdcc4e6b8c721c">base64_encode</a> (const unsigned char *src, size_t len, size_t *out_len)</td></tr>
<tr class="memdesc:ac653f5b6dfa7a11107cdcc4e6b8c721c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode a buffer into base64.  <br /></td></tr>
<tr class="separator:ac653f5b6dfa7a11107cdcc4e6b8c721c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a853216ac51aa181669ff4d3de74058a7" id="r_a853216ac51aa181669ff4d3de74058a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a853216ac51aa181669ff4d3de74058a7">print_help</a> ()</td></tr>
<tr class="memdesc:a853216ac51aa181669ff4d3de74058a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print the interactive help / command menu to stdout.  <br /></td></tr>
<tr class="separator:a853216ac51aa181669ff4d3de74058a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6da18174ed9892c214e56bac27bfc7f" id="r_ad6da18174ed9892c214e56bac27bfc7f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#ad6da18174ed9892c214e56bac27bfc7f">print_banner</a> ()</td></tr>
<tr class="memdesc:ad6da18174ed9892c214e56bac27bfc7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print the ASCII art banner and program metadata.  <br /></td></tr>
<tr class="separator:ad6da18174ed9892c214e56bac27bfc7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba6e2f92cbc0c6c6269dfd20063439d4" id="r_aba6e2f92cbc0c6c6269dfd20063439d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#aba6e2f92cbc0c6c6269dfd20063439d4">add_session</a> (pid_t pid, const char *desc, int in_pipe[], int out_pipe[])</td></tr>
<tr class="memdesc:aba6e2f92cbc0c6c6269dfd20063439d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a new session to the global session list.  <br /></td></tr>
<tr class="separator:aba6e2f92cbc0c6c6269dfd20063439d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaab7ace51d047b5b93a42a1bc808d46" id="r_afaab7ace51d047b5b93a42a1bc808d46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#afaab7ace51d047b5b93a42a1bc808d46">list_sessions</a> ()</td></tr>
<tr class="memdesc:afaab7ace51d047b5b93a42a1bc808d46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print a list of current sessions to stdout.  <br /></td></tr>
<tr class="separator:afaab7ace51d047b5b93a42a1bc808d46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a938464e105c19cfe246687e5ed62e83b" id="r_a938464e105c19cfe246687e5ed62e83b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a938464e105c19cfe246687e5ed62e83b">kill_session</a> (int id)</td></tr>
<tr class="memdesc:a938464e105c19cfe246687e5ed62e83b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Terminate and remove a session by id.  <br /></td></tr>
<tr class="separator:a938464e105c19cfe246687e5ed62e83b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a504d35ae75d68968c45f141b3bbcbbcd" id="r_a504d35ae75d68968c45f141b3bbcbbcd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a504d35ae75d68968c45f141b3bbcbbcd">drain_output</a> (int session_idx)</td></tr>
<tr class="memdesc:a504d35ae75d68968c45f141b3bbcbbcd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read and print available output from a session's output pipe.  <br /></td></tr>
<tr class="separator:a504d35ae75d68968c45f141b3bbcbbcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf50d19801c0a1a670c979ed7414476f" id="r_abf50d19801c0a1a670c979ed7414476f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#abf50d19801c0a1a670c979ed7414476f">upload_file</a> (int id, const char *local_path, const char *remote_name)</td></tr>
<tr class="memdesc:abf50d19801c0a1a670c979ed7414476f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Upload a local file to a remote session by sending base64 chunks.  <br /></td></tr>
<tr class="separator:abf50d19801c0a1a670c979ed7414476f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba3bf760518a9e8f99051a149aa44278" id="r_aba3bf760518a9e8f99051a149aa44278"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#aba3bf760518a9e8f99051a149aa44278">download_file</a> (int id, const char *remote_path, const char *local_name)</td></tr>
<tr class="memdesc:aba3bf760518a9e8f99051a149aa44278"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request a remote file be base64-printed so the operator can download it.  <br /></td></tr>
<tr class="separator:aba3bf760518a9e8f99051a149aa44278"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0c4fb26e646322e0ed84eaccb9abec6" id="r_aa0c4fb26e646322e0ed84eaccb9abec6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#aa0c4fb26e646322e0ed84eaccb9abec6">upgrade</a> (int id)</td></tr>
<tr class="memdesc:aa0c4fb26e646322e0ed84eaccb9abec6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempt to upgrade a remote shell into an interactive PTY.  <br /></td></tr>
<tr class="separator:aa0c4fb26e646322e0ed84eaccb9abec6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90c498b005e5a791ee3571c7526d6ef8" id="r_a90c498b005e5a791ee3571c7526d6ef8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a90c498b005e5a791ee3571c7526d6ef8">remove_session_at_index</a> (int idx)</td></tr>
<tr class="memdesc:a90c498b005e5a791ee3571c7526d6ef8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove and cleanup a session by array index (0-based).  <br /></td></tr>
<tr class="separator:a90c498b005e5a791ee3571c7526d6ef8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ac8c57000bf344f575d3f3ad1dc4e9f" id="r_a5ac8c57000bf344f575d3f3ad1dc4e9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a5ac8c57000bf344f575d3f3ad1dc4e9f">check_sessions</a> ()</td></tr>
<tr class="memdesc:a5ac8c57000bf344f575d3f3ad1dc4e9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Poll all sessions to detect terminated child processes.  <br /></td></tr>
<tr class="separator:a5ac8c57000bf344f575d3f3ad1dc4e9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae68d61c35976cb4b4e3b2a51f2ae2412" id="r_ae68d61c35976cb4b4e3b2a51f2ae2412"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#ae68d61c35976cb4b4e3b2a51f2ae2412">interact_session</a> (int id)</td></tr>
<tr class="memdesc:ae68d61c35976cb4b4e3b2a51f2ae2412"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interact with a session in a pseudo-terminal loop.  <br /></td></tr>
<tr class="separator:ae68d61c35976cb4b4e3b2a51f2ae2412"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63e555e101e53f240af566cf6650ac8d" id="r_a63e555e101e53f240af566cf6650ac8d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a63e555e101e53f240af566cf6650ac8d">start_listener</a> (const char *port)</td></tr>
<tr class="memdesc:a63e555e101e53f240af566cf6650ac8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start a netcat listener on the specified port and register a session.  <br /></td></tr>
<tr class="separator:a63e555e101e53f240af566cf6650ac8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add2ae839253cf752c14f638ded505a22" id="r_add2ae839253cf752c14f638ded505a22"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#add2ae839253cf752c14f638ded505a22">connect_target</a> (const char *ip, const char *port)</td></tr>
<tr class="memdesc:add2ae839253cf752c14f638ded505a22"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connect to a remote bind shell using netcat and register a session.  <br /></td></tr>
<tr class="separator:add2ae839253cf752c14f638ded505a22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3ba7d30d89f8d5afe4b215f0236332f" id="r_ad3ba7d30d89f8d5afe4b215f0236332f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#ad3ba7d30d89f8d5afe4b215f0236332f">ensure_rlwrap</a> (int argc, char **argv)</td></tr>
<tr class="separator:ad3ba7d30d89f8d5afe4b215f0236332f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627" id="r_a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">Program entry point and interactive command loop.  <br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2b2b503f5b2275d94e6607251bd90bd5" id="r_a2b2b503f5b2275d94e6607251bd90bd5"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structSession.html">Session</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a> [<a class="el" href="documented_8c.html#ad3ef68d2292999ee3beb635427a515ef">MAX_SESSIONS</a>]</td></tr>
<tr class="memdesc:a2b2b503f5b2275d94e6607251bd90bd5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Global array storing active sessions.  <br /></td></tr>
<tr class="separator:a2b2b503f5b2275d94e6607251bd90bd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7aa5af3eb4d501b0c44c590507f751e8" id="r_a7aa5af3eb4d501b0c44c590507f751e8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a> = 0</td></tr>
<tr class="memdesc:a7aa5af3eb4d501b0c44c590507f751e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current number of sessions in <code>sessions</code>.  <br /></td></tr>
<tr class="separator:a7aa5af3eb4d501b0c44c590507f751e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfb7807bca1894b8f5eda68986aac98d" id="r_abfb7807bca1894b8f5eda68986aac98d"><td class="memItemLeft" align="right" valign="top">static const char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="documented_8c.html#abfb7807bca1894b8f5eda68986aac98d">b64_table</a> []</td></tr>
<tr class="memdesc:abfb7807bca1894b8f5eda68986aac98d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base64 translation table used by <a class="el" href="documented_8c.html#ac653f5b6dfa7a11107cdcc4e6b8c721c" title="Encode a buffer into base64.">base64_encode()</a>.  <br /></td></tr>
<tr class="separator:abfb7807bca1894b8f5eda68986aac98d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a6c8fad838ed64cc67da3f68149009758" name="a6c8fad838ed64cc67da3f68149009758"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c8fad838ed64cc67da3f68149009758">&#9670;&#160;</a></span>AUTHOR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTHOR&#160;&#160;&#160;&quot;Abdullah, Abdulaziz&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Author string used in banners. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00044">44</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>

</div>
</div>
<a id="a6b20d41d6252e9871430c242cb1a56e7" name="a6b20d41d6252e9871430c242cb1a56e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b20d41d6252e9871430c242cb1a56e7">&#9670;&#160;</a></span>BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUFFER_SIZE&#160;&#160;&#160;4096</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generic buffer size used for IO operations. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00062">62</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>

</div>
</div>
<a id="ad3ef68d2292999ee3beb635427a515ef" name="ad3ef68d2292999ee3beb635427a515ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3ef68d2292999ee3beb635427a515ef">&#9670;&#160;</a></span>MAX_SESSIONS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_SESSIONS&#160;&#160;&#160;20</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum number of concurrent sessions supported. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00056">56</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>

</div>
</div>
<a id="a41d49c9bf1512077295129c1406be4cd" name="a41d49c9bf1512077295129c1406be4cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41d49c9bf1512077295129c1406be4cd">&#9670;&#160;</a></span>URL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define URL&#160;&#160;&#160;&quot;https://github.com/TUKS-Project/TUS-Manager&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Project repository URL. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00050">50</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>

</div>
</div>
<a id="a1c6d5de492ac61ad29aec7aa9a436bbf" name="a1c6d5de492ac61ad29aec7aa9a436bbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c6d5de492ac61ad29aec7aa9a436bbf">&#9670;&#160;</a></span>VERSION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION&#160;&#160;&#160;&quot;1.0&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Program version string. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00038">38</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aba6e2f92cbc0c6c6269dfd20063439d4" name="aba6e2f92cbc0c6c6269dfd20063439d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba6e2f92cbc0c6c6269dfd20063439d4">&#9670;&#160;</a></span>add_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_session </td>
          <td>(</td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>in_pipe</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>out_pipe</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a new session to the global session list. </p>
<p>This function registers the metadata and pipe file descriptors for a newly-forked child process running netcat. It also sets the child's output pipe to non-blocking mode so drains can use EAGAIN to detect end-of-data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pid</td><td>Child process ID for the session. </td></tr>
    <tr><td class="paramname">desc</td><td>Short textual description for the session. </td></tr>
    <tr><td class="paramname">in_pipe</td><td>Array of two file descriptors for the input pipe. </td></tr>
    <tr><td class="paramname">out_pipe</td><td>Array of two file descriptors for the output pipe. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00237">237</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  237</span>                                                                              {</div>
<div class="line"><span class="lineno">  238</span>     <span class="keywordflow">if</span> (<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a> &gt;= <a class="code hl_define" href="documented_8c.html#ad3ef68d2292999ee3beb635427a515ef">MAX_SESSIONS</a>) {</div>
<div class="line"><span class="lineno">  239</span>         printf(<span class="stringliteral">&quot;[!] Session limit reached\n&quot;</span>);</div>
<div class="line"><span class="lineno">  240</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  241</span>     }</div>
<div class="line"><span class="lineno">  242</span>     </div>
<div class="line"><span class="lineno">  243</span>     <span class="comment">// Make output pipe non-blocking</span></div>
<div class="line"><span class="lineno">  244</span>     <span class="keywordtype">int</span> flags = fcntl(out_pipe[0], F_GETFL, 0);</div>
<div class="line"><span class="lineno">  245</span>     fcntl(out_pipe[0], F_SETFL, flags | O_NONBLOCK);</div>
<div class="line"><span class="lineno">  246</span>     </div>
<div class="line"><span class="lineno">  247</span>     <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].<a class="code hl_variable" href="structSession.html#a40fe33141283136858bf8f11b6f5cc46">id</a> = <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a> + 1;</div>
<div class="line"><span class="lineno">  248</span>     <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].<a class="code hl_variable" href="structSession.html#afb70f6426ccf8c1dd04ef202c9e62d62">pid</a> = pid;</div>
<div class="line"><span class="lineno">  249</span>     strncpy(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].desc, desc, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].desc) - 1);</div>
<div class="line"><span class="lineno">  250</span>     <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].<a class="code hl_variable" href="structSession.html#a9938531427c204f8d77d4a907d81893c">desc</a>[<span class="keyword">sizeof</span>(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].<a class="code hl_variable" href="structSession.html#a9938531427c204f8d77d4a907d81893c">desc</a>) - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  251</span>     <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].<a class="code hl_variable" href="structSession.html#a11e7fede6ad759c3c2a35ecb25731746">active</a> = 0;</div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span>     <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].<a class="code hl_variable" href="structSession.html#aaf267cce0b25a4656cae39dcacca9479">in_pipe</a>[0] = in_pipe[0];</div>
<div class="line"><span class="lineno">  254</span>     <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].<a class="code hl_variable" href="structSession.html#aaf267cce0b25a4656cae39dcacca9479">in_pipe</a>[1] = in_pipe[1];</div>
<div class="line"><span class="lineno">  255</span>     <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].<a class="code hl_variable" href="structSession.html#a812f7fdc43d93463e8f97a50d96cf956">out_pipe</a>[0] = out_pipe[0];</div>
<div class="line"><span class="lineno">  256</span>     <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>].<a class="code hl_variable" href="structSession.html#a812f7fdc43d93463e8f97a50d96cf956">out_pipe</a>[1] = out_pipe[1];</div>
<div class="line"><span class="lineno">  257</span> </div>
<div class="line"><span class="lineno">  258</span>     <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>++;</div>
<div class="line"><span class="lineno">  259</span> }</div>
<div class="ttc" id="adocumented_8c_html_a2b2b503f5b2275d94e6607251bd90bd5"><div class="ttname"><a href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a></div><div class="ttdeci">struct Session sessions[MAX_SESSIONS]</div><div class="ttdoc">Global array storing active sessions.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00086">documented.c:86</a></div></div>
<div class="ttc" id="adocumented_8c_html_a7aa5af3eb4d501b0c44c590507f751e8"><div class="ttname"><a href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a></div><div class="ttdeci">int session_count</div><div class="ttdoc">Current number of sessions in sessions.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00091">documented.c:91</a></div></div>
<div class="ttc" id="adocumented_8c_html_ad3ef68d2292999ee3beb635427a515ef"><div class="ttname"><a href="documented_8c.html#ad3ef68d2292999ee3beb635427a515ef">MAX_SESSIONS</a></div><div class="ttdeci">#define MAX_SESSIONS</div><div class="ttdoc">Maximum number of concurrent sessions supported.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00056">documented.c:56</a></div></div>
<div class="ttc" id="astructSession_html_a11e7fede6ad759c3c2a35ecb25731746"><div class="ttname"><a href="structSession.html#a11e7fede6ad759c3c2a35ecb25731746">Session::active</a></div><div class="ttdeci">int active</div><div class="ttdoc">Non-zero if session is currently interactive.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00078">documented.c:78</a></div></div>
<div class="ttc" id="astructSession_html_a40fe33141283136858bf8f11b6f5cc46"><div class="ttname"><a href="structSession.html#a40fe33141283136858bf8f11b6f5cc46">Session::id</a></div><div class="ttdeci">int id</div><div class="ttdoc">Unique session id (1-based index).</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00074">documented.c:74</a></div></div>
<div class="ttc" id="astructSession_html_a812f7fdc43d93463e8f97a50d96cf956"><div class="ttname"><a href="structSession.html#a812f7fdc43d93463e8f97a50d96cf956">Session::out_pipe</a></div><div class="ttdeci">int out_pipe[2]</div><div class="ttdoc">Pipe pair for reading nc output (parent reads from out_pipe[0]).</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00080">documented.c:80</a></div></div>
<div class="ttc" id="astructSession_html_a9938531427c204f8d77d4a907d81893c"><div class="ttname"><a href="structSession.html#a9938531427c204f8d77d4a907d81893c">Session::desc</a></div><div class="ttdeci">char desc[128]</div><div class="ttdoc">Short textual description (e.g.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00076">documented.c:76</a></div></div>
<div class="ttc" id="astructSession_html_aaf267cce0b25a4656cae39dcacca9479"><div class="ttname"><a href="structSession.html#aaf267cce0b25a4656cae39dcacca9479">Session::in_pipe</a></div><div class="ttdeci">int in_pipe[2]</div><div class="ttdoc">Pipe pair for sending commands to nc (parent writes to in_pipe[1]).</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00079">documented.c:79</a></div></div>
<div class="ttc" id="astructSession_html_afb70f6426ccf8c1dd04ef202c9e62d62"><div class="ttname"><a href="structSession.html#afb70f6426ccf8c1dd04ef202c9e62d62">Session::pid</a></div><div class="ttdeci">pid_t pid</div><div class="ttdoc">PID of the child process running nc.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00075">documented.c:75</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_aba6e2f92cbc0c6c6269dfd20063439d4_icgraph.svg" width="383" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac653f5b6dfa7a11107cdcc4e6b8c721c" name="ac653f5b6dfa7a11107cdcc4e6b8c721c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac653f5b6dfa7a11107cdcc4e6b8c721c">&#9670;&#160;</a></span>base64_encode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * base64_encode </td>
          <td>(</td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>out_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode a buffer into base64. </p>
<p>This function allocates a new NUL-terminated string containing the base64 representation of the input buffer. The caller is responsible for calling free() on the returned pointer. If <code>out_len</code> is non-NULL, it receives the length of the encoded string (not including the terminating NUL).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">src</td><td>Pointer to input bytes to be encoded. </td></tr>
    <tr><td class="paramname">len</td><td>Length of the input buffer in bytes. </td></tr>
    <tr><td class="paramname">out_len</td><td>Optional pointer to receive the length of the returned string. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to a malloc'd NUL-terminated base64 string on success, or NULL on error (allocation failure). </dd></dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00114">114</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  114</span>                                                                            {</div>
<div class="line"><span class="lineno">  115</span>     <span class="keywordtype">char</span> *out, *pos;</div>
<div class="line"><span class="lineno">  116</span>     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end, *in;</div>
<div class="line"><span class="lineno">  117</span>     <span class="keywordtype">size_t</span> olen;</div>
<div class="line"><span class="lineno">  118</span> </div>
<div class="line"><span class="lineno">  119</span>     olen = 4 * ((len + 2) / 3);</div>
<div class="line"><span class="lineno">  120</span>     <span class="keywordflow">if</span> (olen &lt; len) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  121</span> </div>
<div class="line"><span class="lineno">  122</span>     out = malloc(olen + 1);</div>
<div class="line"><span class="lineno">  123</span>     <span class="keywordflow">if</span> (!out) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>     end = src + len;</div>
<div class="line"><span class="lineno">  126</span>     in = src;</div>
<div class="line"><span class="lineno">  127</span>     pos = out;</div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span>     <span class="keywordflow">while</span> (end - in &gt;= 3) {</div>
<div class="line"><span class="lineno">  130</span>         *pos++ = <a class="code hl_variable" href="documented_8c.html#abfb7807bca1894b8f5eda68986aac98d">b64_table</a>[in[0] &gt;&gt; 2];</div>
<div class="line"><span class="lineno">  131</span>         *pos++ = <a class="code hl_variable" href="documented_8c.html#abfb7807bca1894b8f5eda68986aac98d">b64_table</a>[((in[0] &amp; 0x03) &lt;&lt; 4) | (in[1] &gt;&gt; 4)];</div>
<div class="line"><span class="lineno">  132</span>         *pos++ = <a class="code hl_variable" href="documented_8c.html#abfb7807bca1894b8f5eda68986aac98d">b64_table</a>[((in[1] &amp; 0x0f) &lt;&lt; 2) | (in[2] &gt;&gt; 6)];</div>
<div class="line"><span class="lineno">  133</span>         *pos++ = <a class="code hl_variable" href="documented_8c.html#abfb7807bca1894b8f5eda68986aac98d">b64_table</a>[in[2] &amp; 0x3f];</div>
<div class="line"><span class="lineno">  134</span>         in += 3;</div>
<div class="line"><span class="lineno">  135</span>     }</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>     <span class="keywordflow">if</span> (end - in) {</div>
<div class="line"><span class="lineno">  138</span>         *pos++ = <a class="code hl_variable" href="documented_8c.html#abfb7807bca1894b8f5eda68986aac98d">b64_table</a>[in[0] &gt;&gt; 2];</div>
<div class="line"><span class="lineno">  139</span>         <span class="keywordflow">if</span> (end - in == 1) {</div>
<div class="line"><span class="lineno">  140</span>             *pos++ = <a class="code hl_variable" href="documented_8c.html#abfb7807bca1894b8f5eda68986aac98d">b64_table</a>[(in[0] &amp; 0x03) &lt;&lt; 4];</div>
<div class="line"><span class="lineno">  141</span>             *pos++ = <span class="charliteral">&#39;=&#39;</span>;</div>
<div class="line"><span class="lineno">  142</span>         } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  143</span>             *pos++ = <a class="code hl_variable" href="documented_8c.html#abfb7807bca1894b8f5eda68986aac98d">b64_table</a>[((in[0] &amp; 0x03) &lt;&lt; 4) | (in[1] &gt;&gt; 4)];</div>
<div class="line"><span class="lineno">  144</span>             *pos++ = <a class="code hl_variable" href="documented_8c.html#abfb7807bca1894b8f5eda68986aac98d">b64_table</a>[(in[1] &amp; 0x0f) &lt;&lt; 2];</div>
<div class="line"><span class="lineno">  145</span>         }</div>
<div class="line"><span class="lineno">  146</span>         *pos++ = <span class="charliteral">&#39;=&#39;</span>;</div>
<div class="line"><span class="lineno">  147</span>     }</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>     *pos = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  150</span>     <span class="keywordflow">if</span> (out_len) *out_len = pos - out;</div>
<div class="line"><span class="lineno">  151</span>     <span class="keywordflow">return</span> out;</div>
<div class="line"><span class="lineno">  152</span> }</div>
<div class="ttc" id="adocumented_8c_html_abfb7807bca1894b8f5eda68986aac98d"><div class="ttname"><a href="documented_8c.html#abfb7807bca1894b8f5eda68986aac98d">b64_table</a></div><div class="ttdeci">static const char b64_table[]</div><div class="ttdoc">Base64 translation table used by base64_encode().</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00097">documented.c:97</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_ac653f5b6dfa7a11107cdcc4e6b8c721c_icgraph.svg" width="378" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5ac8c57000bf344f575d3f3ad1dc4e9f" name="a5ac8c57000bf344f575d3f3ad1dc4e9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ac8c57000bf344f575d3f3ad1dc4e9f">&#9670;&#160;</a></span>check_sessions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_sessions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Poll all sessions to detect terminated child processes. </p>
<p>This walks the sessions array and calls waitpid(..., WNOHANG) for each child. If a child has exited the session is cleaned up via <a class="el" href="documented_8c.html#a90c498b005e5a791ee3571c7526d6ef8" title="Remove and cleanup a session by array index (0-based).">remove_session_at_index()</a>. The function is non-blocking and intended to be called periodically from the main loop. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00528">528</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  528</span>                       {</div>
<div class="line"><span class="lineno">  529</span>     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>; <span class="comment">/* increment inside */</span>) {</div>
<div class="line"><span class="lineno">  530</span>         pid_t pid = <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].<a class="code hl_variable" href="structSession.html#afb70f6426ccf8c1dd04ef202c9e62d62">pid</a>;</div>
<div class="line"><span class="lineno">  531</span>         <span class="keywordflow">if</span> (pid &lt;= 0) { i++; <span class="keywordflow">continue</span>; }</div>
<div class="line"><span class="lineno">  532</span> </div>
<div class="line"><span class="lineno">  533</span>         <span class="keywordtype">int</span> status = 0;</div>
<div class="line"><span class="lineno">  534</span>         pid_t w = waitpid(pid, &amp;status, WNOHANG);</div>
<div class="line"><span class="lineno">  535</span>         <span class="keywordflow">if</span> (w == 0) {</div>
<div class="line"><span class="lineno">  536</span>             <span class="comment">// child still running</span></div>
<div class="line"><span class="lineno">  537</span>             i++;</div>
<div class="line"><span class="lineno">  538</span>             <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  539</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (w == pid) {</div>
<div class="line"><span class="lineno">  540</span>             <span class="comment">// child exited</span></div>
<div class="line"><span class="lineno">  541</span>             printf(<span class="stringliteral">&quot;\n[*] Session %d (PID %d) terminated.\n&quot;</span>, <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].<span class="keywordtype">id</span>, pid);</div>
<div class="line"><span class="lineno">  542</span>             <a class="code hl_function" href="documented_8c.html#a90c498b005e5a791ee3571c7526d6ef8">remove_session_at_index</a>(i);</div>
<div class="line"><span class="lineno">  543</span>             <span class="comment">// Do not increment i — array shifted, current i is next element</span></div>
<div class="line"><span class="lineno">  544</span>         } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  545</span>             <span class="comment">// waitpid error (ECHILD or other) - remove conservative</span></div>
<div class="line"><span class="lineno">  546</span>             <span class="keywordflow">if</span> (errno != ECHILD) {</div>
<div class="line"><span class="lineno">  547</span>                 perror(<span class="stringliteral">&quot;waitpid&quot;</span>);</div>
<div class="line"><span class="lineno">  548</span>             }</div>
<div class="line"><span class="lineno">  549</span>             <a class="code hl_function" href="documented_8c.html#a90c498b005e5a791ee3571c7526d6ef8">remove_session_at_index</a>(i);</div>
<div class="line"><span class="lineno">  550</span>         }</div>
<div class="line"><span class="lineno">  551</span>     }</div>
<div class="line"><span class="lineno">  552</span> }</div>
<div class="ttc" id="adocumented_8c_html_a90c498b005e5a791ee3571c7526d6ef8"><div class="ttname"><a href="documented_8c.html#a90c498b005e5a791ee3571c7526d6ef8">remove_session_at_index</a></div><div class="ttdeci">void remove_session_at_index(int idx)</div><div class="ttdoc">Remove and cleanup a session by array index (0-based).</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00498">documented.c:498</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_a5ac8c57000bf344f575d3f3ad1dc4e9f_cgraph.svg" width="372" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_a5ac8c57000bf344f575d3f3ad1dc4e9f_icgraph.svg" width="236" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="add2ae839253cf752c14f638ded505a22" name="add2ae839253cf752c14f638ded505a22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add2ae839253cf752c14f638ded505a22">&#9670;&#160;</a></span>connect_target()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connect_target </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>ip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Connect to a remote bind shell using netcat and register a session. </p>
<p>This function forks a child process that execs <code>nc &lt;ip&gt; &lt;port&gt;</code> and prepares pipes for communicating with the remote endpoint.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ip</td><td>IP address or hostname to connect to. </td></tr>
    <tr><td class="paramname">port</td><td>Port number string to connect to. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00713">713</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  713</span>                                                       {</div>
<div class="line"><span class="lineno">  714</span>     <span class="keywordtype">int</span> in_pipe[2];</div>
<div class="line"><span class="lineno">  715</span>     <span class="keywordtype">int</span> out_pipe[2];</div>
<div class="line"><span class="lineno">  716</span> </div>
<div class="line"><span class="lineno">  717</span>     <span class="keywordflow">if</span> (pipe(in_pipe) &lt; 0 || pipe(out_pipe) &lt; 0) {</div>
<div class="line"><span class="lineno">  718</span>         perror(<span class="stringliteral">&quot;pipe&quot;</span>);</div>
<div class="line"><span class="lineno">  719</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  720</span>     }</div>
<div class="line"><span class="lineno">  721</span> </div>
<div class="line"><span class="lineno">  722</span>     pid_t pid = fork();</div>
<div class="line"><span class="lineno">  723</span>     <span class="keywordflow">if</span> (pid == 0) {</div>
<div class="line"><span class="lineno">  724</span>         dup2(in_pipe[0], STDIN_FILENO);</div>
<div class="line"><span class="lineno">  725</span>         dup2(out_pipe[1], STDOUT_FILENO);</div>
<div class="line"><span class="lineno">  726</span>         dup2(out_pipe[1], STDERR_FILENO);</div>
<div class="line"><span class="lineno">  727</span> </div>
<div class="line"><span class="lineno">  728</span>         close(in_pipe[1]);</div>
<div class="line"><span class="lineno">  729</span>         close(out_pipe[0]);</div>
<div class="line"><span class="lineno">  730</span> </div>
<div class="line"><span class="lineno">  731</span>         execlp(<span class="stringliteral">&quot;nc&quot;</span>, <span class="stringliteral">&quot;nc&quot;</span>, ip, port, NULL);</div>
<div class="line"><span class="lineno">  732</span>         perror(<span class="stringliteral">&quot;execlp&quot;</span>);</div>
<div class="line"><span class="lineno">  733</span>         exit(1);</div>
<div class="line"><span class="lineno">  734</span>     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pid &gt; 0) {</div>
<div class="line"><span class="lineno">  735</span>         close(in_pipe[0]);</div>
<div class="line"><span class="lineno">  736</span>         close(out_pipe[1]);</div>
<div class="line"><span class="lineno">  737</span> </div>
<div class="line"><span class="lineno">  738</span>         <span class="keywordtype">char</span> desc[128];</div>
<div class="line"><span class="lineno">  739</span>         snprintf(desc, <span class="keyword">sizeof</span>(desc), <span class="stringliteral">&quot;Connected to %s:%s&quot;</span>, ip, port);</div>
<div class="line"><span class="lineno">  740</span>         <a class="code hl_function" href="documented_8c.html#aba6e2f92cbc0c6c6269dfd20063439d4">add_session</a>(pid, desc, in_pipe, out_pipe);</div>
<div class="line"><span class="lineno">  741</span>         printf(<span class="stringliteral">&quot;[*] Connected to %s:%s [session %d]\n&quot;</span>, ip, port, <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>);</div>
<div class="line"><span class="lineno">  742</span>     } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  743</span>         perror(<span class="stringliteral">&quot;fork&quot;</span>);</div>
<div class="line"><span class="lineno">  744</span>     }</div>
<div class="line"><span class="lineno">  745</span> }</div>
<div class="ttc" id="adocumented_8c_html_aba6e2f92cbc0c6c6269dfd20063439d4"><div class="ttname"><a href="documented_8c.html#aba6e2f92cbc0c6c6269dfd20063439d4">add_session</a></div><div class="ttdeci">void add_session(pid_t pid, const char *desc, int in_pipe[], int out_pipe[])</div><div class="ttdoc">Add a new session to the global session list.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00237">documented.c:237</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_add2ae839253cf752c14f638ded505a22_cgraph.svg" width="280" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_add2ae839253cf752c14f638ded505a22_icgraph.svg" width="232" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aba3bf760518a9e8f99051a149aa44278" name="aba3bf760518a9e8f99051a149aa44278"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba3bf760518a9e8f99051a149aa44278">&#9670;&#160;</a></span>download_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void download_file </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>remote_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>local_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request a remote file be base64-printed so the operator can download it. </p>
<p>The function sends a command to the remote shell to base64-encode the specified <code>remote_path</code> and prints a hint on how to decode the data locally. The actual base64 payload will appear in the session output which the user can capture and decode locally.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>1-based session id to request the remote file from. </td></tr>
    <tr><td class="paramname">remote_path</td><td>Path to the file on the remote host. </td></tr>
    <tr><td class="paramname">local_name</td><td>Suggested filename to use when decoding locally. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00432">432</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  432</span>                                                                             {</div>
<div class="line"><span class="lineno">  433</span>     <span class="keywordflow">if</span> (id &lt;= 0 || id &gt; <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>) {</div>
<div class="line"><span class="lineno">  434</span>         printf(<span class="stringliteral">&quot;[!] Invalid session ID\n&quot;</span>);</div>
<div class="line"><span class="lineno">  435</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  436</span>     }</div>
<div class="line"><span class="lineno">  437</span> </div>
<div class="line"><span class="lineno">  438</span>     <span class="keywordtype">char</span> command[<a class="code hl_define" href="documented_8c.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>];</div>
<div class="line"><span class="lineno">  439</span>     </div>
<div class="line"><span class="lineno">  440</span>     printf(<span class="stringliteral">&quot;[*] Starting download of %s...\n&quot;</span>, remote_path);</div>
<div class="line"><span class="lineno">  441</span>     </div>
<div class="line"><span class="lineno">  442</span>     <span class="comment">// Send command to base64 encode the remote file</span></div>
<div class="line"><span class="lineno">  443</span>     snprintf(command, <span class="keyword">sizeof</span>(command), <span class="stringliteral">&quot;base64 &#39;%s&#39; 2&gt;/dev/null || echo &#39;FILE_NOT_FOUND&#39;\n&quot;</span>, remote_path);</div>
<div class="line"><span class="lineno">  444</span>     write(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<span class="keywordtype">id</span> - 1].in_pipe[1], command, strlen(command));</div>
<div class="line"><span class="lineno">  445</span>     </div>
<div class="line"><span class="lineno">  446</span>     printf(<span class="stringliteral">&quot;[*] Download command sent. Check session output for base64 data.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  447</span>     printf(<span class="stringliteral">&quot;[*] You can manually decode with: base64 -d &gt; %s\n&quot;</span>, local_name);</div>
<div class="line"><span class="lineno">  448</span> }</div>
<div class="ttc" id="adocumented_8c_html_a6b20d41d6252e9871430c242cb1a56e7"><div class="ttname"><a href="documented_8c.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a></div><div class="ttdeci">#define BUFFER_SIZE</div><div class="ttdoc">Generic buffer size used for IO operations.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00062">documented.c:62</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_aba3bf760518a9e8f99051a149aa44278_icgraph.svg" width="226" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a504d35ae75d68968c45f141b3bbcbbcd" name="a504d35ae75d68968c45f141b3bbcbbcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a504d35ae75d68968c45f141b3bbcbbcd">&#9670;&#160;</a></span>drain_output()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int drain_output </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>session_idx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read and print available output from a session's output pipe. </p>
<p>This function repeatedly reads from the session's out_pipe[0] until the pipe would block (EAGAIN/EWOULDBLOCK) or EOF is reached. Any data read is printed to stdout. On EOF or error the function returns -1, otherwise it returns the total number of bytes read during this call.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">session_idx</td><td>Index (0-based) into the global sessions array. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of bytes read (&gt;0) on success, 0 if no data available, or -1 if the session closed or an unrecoverable error occurred. </dd></dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00329">329</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  329</span>                                   {</div>
<div class="line"><span class="lineno">  330</span>     <span class="keywordtype">char</span> buffer[<a class="code hl_define" href="documented_8c.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>];</div>
<div class="line"><span class="lineno">  331</span>     <span class="keywordtype">int</span> total_bytes = 0;</div>
<div class="line"><span class="lineno">  332</span>     </div>
<div class="line"><span class="lineno">  333</span>     <span class="keywordflow">while</span> (1) {</div>
<div class="line"><span class="lineno">  334</span>         <span class="keywordtype">int</span> bytes_read = read(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[session_idx].out_pipe[0], buffer, <a class="code hl_define" href="documented_8c.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a> - 1);</div>
<div class="line"><span class="lineno">  335</span>         <span class="keywordflow">if</span> (bytes_read &gt; 0) {</div>
<div class="line"><span class="lineno">  336</span>             buffer[bytes_read] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  337</span>             printf(<span class="stringliteral">&quot;%s&quot;</span>, buffer);</div>
<div class="line"><span class="lineno">  338</span>             fflush(stdout);</div>
<div class="line"><span class="lineno">  339</span>             total_bytes += bytes_read;</div>
<div class="line"><span class="lineno">  340</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bytes_read == 0) {</div>
<div class="line"><span class="lineno">  341</span>             <span class="comment">// EOF - session closed</span></div>
<div class="line"><span class="lineno">  342</span>             <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  343</span>         } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  344</span>             <span class="comment">// EAGAIN/EWOULDBLOCK or other error</span></div>
<div class="line"><span class="lineno">  345</span>             <span class="keywordflow">if</span> (errno == EAGAIN || errno == EWOULDBLOCK) {</div>
<div class="line"><span class="lineno">  346</span>                 <span class="keywordflow">break</span>; <span class="comment">// No more data available</span></div>
<div class="line"><span class="lineno">  347</span>             } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  348</span>                 perror(<span class="stringliteral">&quot;read&quot;</span>);</div>
<div class="line"><span class="lineno">  349</span>                 <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  350</span>             }</div>
<div class="line"><span class="lineno">  351</span>         }</div>
<div class="line"><span class="lineno">  352</span>     }</div>
<div class="line"><span class="lineno">  353</span>     <span class="keywordflow">return</span> total_bytes;</div>
<div class="line"><span class="lineno">  354</span> }</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_a504d35ae75d68968c45f141b3bbcbbcd_icgraph.svg" width="394" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad3ba7d30d89f8d5afe4b215f0236332f" name="ad3ba7d30d89f8d5afe4b215f0236332f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3ba7d30d89f8d5afe4b215f0236332f">&#9670;&#160;</a></span>ensure_rlwrap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ensure_rlwrap </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00747">747</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  747</span>                                                  {</div>
<div class="line"><span class="lineno">  748</span>    <span class="comment">/* If already wrapped (or user forced skip) -&gt; do nothing */</span></div>
<div class="line"><span class="lineno">  749</span>    <span class="keywordflow">if</span> (getenv(<span class="stringliteral">&quot;TUKS_RLWRAPPED&quot;</span>) != NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  750</span> </div>
<div class="line"><span class="lineno">  751</span>    <span class="comment">/* Build new argv: {&quot;rlwrap&quot;, argv[0], argv[1], ..., NULL} */</span></div>
<div class="line"><span class="lineno">  752</span>    <span class="keywordtype">char</span> **newargv = malloc((argc + 2) * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));</div>
<div class="line"><span class="lineno">  753</span>    <span class="keywordflow">if</span> (!newargv) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span>    newargv[0] = <span class="stringliteral">&quot;rlwrap&quot;</span>;</div>
<div class="line"><span class="lineno">  756</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; argc; ++i) {</div>
<div class="line"><span class="lineno">  757</span>        newargv[i + 1] = argv[i];</div>
<div class="line"><span class="lineno">  758</span>    }</div>
<div class="line"><span class="lineno">  759</span>    newargv[argc + 1] = NULL;</div>
<div class="line"><span class="lineno">  760</span> </div>
<div class="line"><span class="lineno">  761</span>    <span class="comment">/* Mark environment so the child won&#39;t try to re-wrap again */</span></div>
<div class="line"><span class="lineno">  762</span>    <span class="keywordflow">if</span> (setenv(<span class="stringliteral">&quot;TUKS_RLWRAPPED&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, 1) != 0) {</div>
<div class="line"><span class="lineno">  763</span>        free(newargv);</div>
<div class="line"><span class="lineno">  764</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  765</span>    }</div>
<div class="line"><span class="lineno">  766</span> </div>
<div class="line"><span class="lineno">  767</span>    <span class="comment">/* Replace current process with: rlwrap original-argv... */</span></div>
<div class="line"><span class="lineno">  768</span>    execvp(<span class="stringliteral">&quot;rlwrap&quot;</span>, newargv);</div>
<div class="line"><span class="lineno">  769</span> </div>
<div class="line"><span class="lineno">  770</span>    <span class="comment">/* If execvp returns, it failed. Clean up and continue without rlwrap. */</span></div>
<div class="line"><span class="lineno">  771</span>    <span class="keywordtype">int</span> saved_errno = errno;</div>
<div class="line"><span class="lineno">  772</span>    unsetenv(<span class="stringliteral">&quot;TUKS_RLWRAPPED&quot;</span>);</div>
<div class="line"><span class="lineno">  773</span>    free(newargv);</div>
<div class="line"><span class="lineno">  774</span> </div>
<div class="line"><span class="lineno">  775</span>    <span class="comment">/* If rlwrap is simply not installed, silently continue.</span></div>
<div class="line"><span class="lineno">  776</span><span class="comment">       Otherwise print a diagnostic (optional). */</span></div>
<div class="line"><span class="lineno">  777</span>    <span class="keywordflow">if</span> (saved_errno != ENOENT &amp;&amp; saved_errno != ENOEXEC &amp;&amp; saved_errno != ENOTDIR) {</div>
<div class="line"><span class="lineno">  778</span>        perror(<span class="stringliteral">&quot;execvp(rlwrap)&quot;</span>);</div>
<div class="line"><span class="lineno">  779</span>    }</div>
<div class="line"><span class="lineno">  780</span>    <span class="comment">/* return to main and continue without rlwrap */</span></div>
<div class="line"><span class="lineno">  781</span> }</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_ad3ba7d30d89f8d5afe4b215f0236332f_icgraph.svg" width="228" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae68d61c35976cb4b4e3b2a51f2ae2412" name="ae68d61c35976cb4b4e3b2a51f2ae2412"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae68d61c35976cb4b4e3b2a51f2ae2412">&#9670;&#160;</a></span>interact_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void interact_session </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interact with a session in a pseudo-terminal loop. </p>
<p>The function monitors STDIN and the session's output pipe using select() and forwards data to/from the remote process. Typing the command "/BG" backgrounds the session and returns control to the main menu.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>1-based session id to interact with. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00564">564</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  564</span>                               {</div>
<div class="line"><span class="lineno">  565</span>     <span class="keywordtype">int</span> session_idx = -1;</div>
<div class="line"><span class="lineno">  566</span>     </div>
<div class="line"><span class="lineno">  567</span>     <span class="comment">// Find session</span></div>
<div class="line"><span class="lineno">  568</span>     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>; i++) {</div>
<div class="line"><span class="lineno">  569</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].<span class="keywordtype">id</span> == <span class="keywordtype">id</span>) {</div>
<div class="line"><span class="lineno">  570</span>             session_idx = i;</div>
<div class="line"><span class="lineno">  571</span>             <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  572</span>         }</div>
<div class="line"><span class="lineno">  573</span>     }</div>
<div class="line"><span class="lineno">  574</span>     </div>
<div class="line"><span class="lineno">  575</span>     <span class="keywordflow">if</span> (session_idx == -1) {</div>
<div class="line"><span class="lineno">  576</span>         printf(<span class="stringliteral">&quot;[!] Invalid session ID\n&quot;</span>);</div>
<div class="line"><span class="lineno">  577</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  578</span>     }</div>
<div class="line"><span class="lineno">  579</span> </div>
<div class="line"><span class="lineno">  580</span>     printf(<span class="stringliteral">&quot;[*] Interacting with session %d (type &#39;/BG&#39; to background)\n&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  581</span>     <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[session_idx].<a class="code hl_variable" href="structSession.html#a11e7fede6ad759c3c2a35ecb25731746">active</a> = 1;</div>
<div class="line"><span class="lineno">  582</span> </div>
<div class="line"><span class="lineno">  583</span>     <span class="keywordtype">char</span> input[<a class="code hl_define" href="documented_8c.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>];</div>
<div class="line"><span class="lineno">  584</span>     fd_set readfds;</div>
<div class="line"><span class="lineno">  585</span>     <span class="keywordtype">int</span> max_fd;</div>
<div class="line"><span class="lineno">  586</span> </div>
<div class="line"><span class="lineno">  587</span>     <span class="comment">// Initial drain of any pending output</span></div>
<div class="line"><span class="lineno">  588</span>     <a class="code hl_function" href="documented_8c.html#a504d35ae75d68968c45f141b3bbcbbcd">drain_output</a>(session_idx);</div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span>     <span class="keywordflow">while</span> (1) {</div>
<div class="line"><span class="lineno">  591</span>         <span class="comment">//printf(&quot;TUKSession %d&gt; &quot;, id);</span></div>
<div class="line"><span class="lineno">  592</span>         </div>
<div class="line"><span class="lineno">  593</span>         fflush(stdout);</div>
<div class="line"><span class="lineno">  594</span>        </div>
<div class="line"><span class="lineno">  595</span>         <span class="comment">// Use select to monitor both stdin and session output</span></div>
<div class="line"><span class="lineno">  596</span>         FD_ZERO(&amp;readfds);</div>
<div class="line"><span class="lineno">  597</span>         FD_SET(STDIN_FILENO, &amp;readfds);</div>
<div class="line"><span class="lineno">  598</span>         FD_SET(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[session_idx].out_pipe[0], &amp;readfds);</div>
<div class="line"><span class="lineno">  599</span>         </div>
<div class="line"><span class="lineno">  600</span>         max_fd = (<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[session_idx].<a class="code hl_variable" href="structSession.html#a812f7fdc43d93463e8f97a50d96cf956">out_pipe</a>[0] &gt; STDIN_FILENO) ? </div>
<div class="line"><span class="lineno">  601</span>                  <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[session_idx].out_pipe[0] : STDIN_FILENO;</div>
<div class="line"><span class="lineno">  602</span> </div>
<div class="line"><span class="lineno">  603</span>         <span class="keywordtype">int</span> ready = select(max_fd + 1, &amp;readfds, NULL, NULL, NULL);</div>
<div class="line"><span class="lineno">  604</span>         </div>
<div class="line"><span class="lineno">  605</span>         <span class="keywordflow">if</span> (ready &lt; 0) {</div>
<div class="line"><span class="lineno">  606</span>             <span class="keywordflow">if</span> (errno == EINTR) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  607</span>             perror(<span class="stringliteral">&quot;select&quot;</span>);</div>
<div class="line"><span class="lineno">  608</span>             <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  609</span>         }</div>
<div class="line"><span class="lineno">  610</span>        </div>
<div class="line"><span class="lineno">  611</span> </div>
<div class="line"><span class="lineno">  612</span>         <span class="comment">// Check for output from session</span></div>
<div class="line"><span class="lineno">  613</span>         <span class="keywordflow">if</span> (FD_ISSET(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[session_idx].out_pipe[0], &amp;readfds)) {</div>
<div class="line"><span class="lineno">  614</span>             <span class="keywordtype">int</span> result = <a class="code hl_function" href="documented_8c.html#a504d35ae75d68968c45f141b3bbcbbcd">drain_output</a>(session_idx);</div>
<div class="line"><span class="lineno">  615</span>             <span class="keywordflow">if</span> (result &lt; 0) {</div>
<div class="line"><span class="lineno">  616</span>                 printf(<span class="stringliteral">&quot;\n[*] Session %d closed.\n&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  617</span>                 <a class="code hl_function" href="documented_8c.html#a90c498b005e5a791ee3571c7526d6ef8">remove_session_at_index</a>(session_idx);</div>
<div class="line"><span class="lineno">  618</span>                 <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  619</span>             }</div>
<div class="line"><span class="lineno">  620</span>         }</div>
<div class="line"><span class="lineno">  621</span> </div>
<div class="line"><span class="lineno">  622</span>         <span class="comment">// Check for input from user</span></div>
<div class="line"><span class="lineno">  623</span>         <span class="keywordflow">if</span> (FD_ISSET(STDIN_FILENO, &amp;readfds)) {</div>
<div class="line"><span class="lineno">  624</span>             <span class="keywordflow">if</span> (!fgets(input, <span class="keyword">sizeof</span>(input), stdin)) {</div>
<div class="line"><span class="lineno">  625</span>                 printf(<span class="stringliteral">&quot;\n[*] Input closed. Returning to main menu.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  626</span>                 <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[session_idx].<a class="code hl_variable" href="structSession.html#a11e7fede6ad759c3c2a35ecb25731746">active</a> = 0;</div>
<div class="line"><span class="lineno">  627</span>                 <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  628</span>             }</div>
<div class="line"><span class="lineno">  629</span> </div>
<div class="line"><span class="lineno">  630</span>             <span class="comment">// Remove newline</span></div>
<div class="line"><span class="lineno">  631</span>             input[strcspn(input, <span class="stringliteral">&quot;\n&quot;</span>)] = 0;</div>
<div class="line"><span class="lineno">  632</span> </div>
<div class="line"><span class="lineno">  633</span>             <span class="keywordflow">if</span> (strcmp(input, <span class="stringliteral">&quot;/BG&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  634</span>                 printf(<span class="stringliteral">&quot;[*] Session %d sent to background\n&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  635</span>                 <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[session_idx].<a class="code hl_variable" href="structSession.html#a11e7fede6ad759c3c2a35ecb25731746">active</a> = 0;</div>
<div class="line"><span class="lineno">  636</span>                 <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  637</span>             }</div>
<div class="line"><span class="lineno">  638</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(input, <span class="stringliteral">&quot;clear&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  639</span>                system(<span class="stringliteral">&quot;clear&quot;</span>);</div>
<div class="line"><span class="lineno">  640</span>            }</div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>             <span class="comment">// Send command</span></div>
<div class="line"><span class="lineno">  643</span>             strcat(input, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  644</span>             <span class="keywordflow">if</span> (write(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[session_idx].in_pipe[1], input, strlen(input)) &lt; 0) {</div>
<div class="line"><span class="lineno">  645</span>                 perror(<span class="stringliteral">&quot;write&quot;</span>);</div>
<div class="line"><span class="lineno">  646</span>                 printf(<span class="stringliteral">&quot;[*] Failed to write to session %d. Removing.\n&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  647</span>                 <a class="code hl_function" href="documented_8c.html#a90c498b005e5a791ee3571c7526d6ef8">remove_session_at_index</a>(session_idx);</div>
<div class="line"><span class="lineno">  648</span>                 <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  649</span>             }</div>
<div class="line"><span class="lineno">  650</span> </div>
<div class="line"><span class="lineno">  651</span>             <span class="comment">// Give a moment for output, then drain</span></div>
<div class="line"><span class="lineno">  652</span>             usleep(50000); <span class="comment">// 50ms</span></div>
<div class="line"><span class="lineno">  653</span>             <a class="code hl_function" href="documented_8c.html#a504d35ae75d68968c45f141b3bbcbbcd">drain_output</a>(session_idx);</div>
<div class="line"><span class="lineno">  654</span>         }</div>
<div class="line"><span class="lineno">  655</span>     }</div>
<div class="line"><span class="lineno">  656</span>     </div>
<div class="line"><span class="lineno">  657</span>     <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[session_idx].<a class="code hl_variable" href="structSession.html#a11e7fede6ad759c3c2a35ecb25731746">active</a> = 0;</div>
<div class="line"><span class="lineno">  658</span> }</div>
<div class="ttc" id="adocumented_8c_html_a504d35ae75d68968c45f141b3bbcbbcd"><div class="ttname"><a href="documented_8c.html#a504d35ae75d68968c45f141b3bbcbbcd">drain_output</a></div><div class="ttdeci">int drain_output(int session_idx)</div><div class="ttdoc">Read and print available output from a session's output pipe.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00329">documented.c:329</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_ae68d61c35976cb4b4e3b2a51f2ae2412_cgraph.svg" width="378" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_ae68d61c35976cb4b4e3b2a51f2ae2412_icgraph.svg" width="242" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a938464e105c19cfe246687e5ed62e83b" name="a938464e105c19cfe246687e5ed62e83b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a938464e105c19cfe246687e5ed62e83b">&#9670;&#160;</a></span>kill_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kill_session </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Terminate and remove a session by id. </p>
<p>Sends SIGTERM to the child, waits for it to exit, closes pipes and removes the session entry from the sessions array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>1-based session id to kill. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00293">293</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  293</span>                           {</div>
<div class="line"><span class="lineno">  294</span>     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>; i++) {</div>
<div class="line"><span class="lineno">  295</span>         <span class="keywordflow">if</span> (<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].<span class="keywordtype">id</span> == <span class="keywordtype">id</span>) {</div>
<div class="line"><span class="lineno">  296</span>             kill(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].pid, SIGTERM);</div>
<div class="line"><span class="lineno">  297</span>             waitpid(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].pid, NULL, 0);</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>             close(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].in_pipe[0]);</div>
<div class="line"><span class="lineno">  300</span>             close(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].in_pipe[1]);</div>
<div class="line"><span class="lineno">  301</span>             close(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].out_pipe[0]);</div>
<div class="line"><span class="lineno">  302</span>             close(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].out_pipe[1]);</div>
<div class="line"><span class="lineno">  303</span> </div>
<div class="line"><span class="lineno">  304</span>             printf(<span class="stringliteral">&quot;[*] Session %d killed\n&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  305</span> </div>
<div class="line"><span class="lineno">  306</span>             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = i; j &lt; <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a> - 1; j++) {</div>
<div class="line"><span class="lineno">  307</span>                 <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[j] = <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[j + 1];</div>
<div class="line"><span class="lineno">  308</span>             }</div>
<div class="line"><span class="lineno">  309</span>             <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>--;</div>
<div class="line"><span class="lineno">  310</span>             <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  311</span>         }</div>
<div class="line"><span class="lineno">  312</span>     }</div>
<div class="line"><span class="lineno">  313</span>     printf(<span class="stringliteral">&quot;[!] Invalid session ID\n&quot;</span>);</div>
<div class="line"><span class="lineno">  314</span> }</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_a938464e105c19cfe246687e5ed62e83b_icgraph.svg" width="212" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="afaab7ace51d047b5b93a42a1bc808d46" name="afaab7ace51d047b5b93a42a1bc808d46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afaab7ace51d047b5b93a42a1bc808d46">&#9670;&#160;</a></span>list_sessions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void list_sessions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print a list of current sessions to stdout. </p>
<p>Displays each session's ID, PID, status (active/background) and description in a simple table. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00267">267</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  267</span>                      {</div>
<div class="line"><span class="lineno">  268</span>     <span class="keywordflow">if</span> (<a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a> == 0) {</div>
<div class="line"><span class="lineno">  269</span>         printf(<span class="stringliteral">&quot;[*] No active sessions\n&quot;</span>);</div>
<div class="line"><span class="lineno">  270</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  271</span>     }</div>
<div class="line"><span class="lineno">  272</span>     printf(<span class="stringliteral">&quot;\033[1;36m&quot;</span>);</div>
<div class="line"><span class="lineno">  273</span>     printf(<span class="stringliteral">&quot;ID  PID      STATUS      DESCRIPTION\n&quot;</span>);</div>
<div class="line"><span class="lineno">  274</span>     printf(<span class="stringliteral">&quot;--- -------- ----------- -----------\n&quot;</span>);</div>
<div class="line"><span class="lineno">  275</span>     printf(<span class="stringliteral">&quot;\033[0m&quot;</span>);</div>
<div class="line"><span class="lineno">  276</span>     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>; i++) {</div>
<div class="line"><span class="lineno">  277</span>         printf(<span class="stringliteral">&quot;%-3d %-8d %-11s %s\n&quot;</span>, </div>
<div class="line"><span class="lineno">  278</span>                <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].<span class="keywordtype">id</span>, </div>
<div class="line"><span class="lineno">  279</span>                <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].pid,</div>
<div class="line"><span class="lineno">  280</span>                <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].active ? <span class="stringliteral">&quot;active&quot;</span> : <span class="stringliteral">&quot;background&quot;</span>,</div>
<div class="line"><span class="lineno">  281</span>                <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].desc);</div>
<div class="line"><span class="lineno">  282</span>     }</div>
<div class="line"><span class="lineno">  283</span> }</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_afaab7ace51d047b5b93a42a1bc808d46_icgraph.svg" width="219" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a3c04138a5bfe5d72780bb7e82a18e627" name="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Program entry point and interactive command loop. </p>
<p>The main function optionally re-execs itself under rlwrap for readline-like editing, prints the banner, and enters a simple REPL accepting commands such as "listen", "connect", "list", "use", "upload", "download", "upgrade" and "kill". Periodically <a class="el" href="documented_8c.html#a5ac8c57000bf344f575d3f3ad1dc4e9f" title="Poll all sessions to detect terminated child processes.">check_sessions()</a> is used to reap terminated child processes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>Argument count as passed to the program. </td></tr>
    <tr><td class="paramname">argv</td><td>Argument vector as passed to the program. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns 0 on normal exit. </dd></dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00798">798</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  798</span>                                 {</div>
<div class="line"><span class="lineno">  799</span>    <span class="comment">/* Try to auto-wrap with rlwrap (will exec and not return if successful) */</span></div>
<div class="line"><span class="lineno">  800</span>     <a class="code hl_function" href="documented_8c.html#ad3ba7d30d89f8d5afe4b215f0236332f">ensure_rlwrap</a>(argc, argv);</div>
<div class="line"><span class="lineno">  801</span>     <span class="keywordtype">char</span> input[256];</div>
<div class="line"><span class="lineno">  802</span> </div>
<div class="line"><span class="lineno">  803</span>     system(<span class="stringliteral">&quot;clear&quot;</span>);</div>
<div class="line"><span class="lineno">  804</span>     <a class="code hl_function" href="documented_8c.html#ad6da18174ed9892c214e56bac27bfc7f">print_banner</a>();</div>
<div class="line"><span class="lineno">  805</span>     </div>
<div class="line"><span class="lineno">  806</span>     <span class="comment">// Handle CTRL+Z and CTRL+C</span></div>
<div class="line"><span class="lineno">  807</span> </div>
<div class="line"><span class="lineno">  808</span>     <span class="keywordflow">while</span> (1) {</div>
<div class="line"><span class="lineno">  809</span>         <span class="comment">// Check sessions each loop</span></div>
<div class="line"><span class="lineno">  810</span>         <a class="code hl_function" href="documented_8c.html#a5ac8c57000bf344f575d3f3ad1dc4e9f">check_sessions</a>();</div>
<div class="line"><span class="lineno">  811</span> </div>
<div class="line"><span class="lineno">  812</span>         printf(<span class="stringliteral">&quot;\033[1;32mtuks&gt;\033[0m &quot;</span>);</div>
<div class="line"><span class="lineno">  813</span>         fflush(stdout);</div>
<div class="line"><span class="lineno">  814</span> </div>
<div class="line"><span class="lineno">  815</span>         <span class="keywordflow">if</span> (!fgets(input, <span class="keyword">sizeof</span>(input), stdin)) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  816</span>         input[strcspn(input, <span class="stringliteral">&quot;\n&quot;</span>)] = 0;</div>
<div class="line"><span class="lineno">  817</span> </div>
<div class="line"><span class="lineno">  818</span>         <span class="keywordflow">if</span> (strncmp(input, <span class="stringliteral">&quot;listen&quot;</span>, 6) == 0) {</div>
<div class="line"><span class="lineno">  819</span>             <span class="keywordtype">char</span> port[16];</div>
<div class="line"><span class="lineno">  820</span>             <span class="keywordflow">if</span> (sscanf(input, <span class="stringliteral">&quot;listen %15s&quot;</span>, port) == 1) {</div>
<div class="line"><span class="lineno">  821</span>                 <a class="code hl_function" href="documented_8c.html#a63e555e101e53f240af566cf6650ac8d">start_listener</a>(port);</div>
<div class="line"><span class="lineno">  822</span>             } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  823</span>                 printf(<span class="stringliteral">&quot;Usage: listen &lt;port&gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  824</span>             }</div>
<div class="line"><span class="lineno">  825</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(input, <span class="stringliteral">&quot;connect&quot;</span>, 7) == 0) {</div>
<div class="line"><span class="lineno">  826</span>             <span class="keywordtype">char</span> ip[64], port[16];</div>
<div class="line"><span class="lineno">  827</span>             <span class="keywordflow">if</span> (sscanf(input, <span class="stringliteral">&quot;connect %63s %15s&quot;</span>, ip, port) == 2) {</div>
<div class="line"><span class="lineno">  828</span>                 <a class="code hl_function" href="documented_8c.html#add2ae839253cf752c14f638ded505a22">connect_target</a>(ip, port);</div>
<div class="line"><span class="lineno">  829</span>             } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  830</span>                 printf(<span class="stringliteral">&quot;Usage: connect &lt;ip&gt; &lt;port&gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  831</span>             }</div>
<div class="line"><span class="lineno">  832</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(input, <span class="stringliteral">&quot;list&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  833</span>             <a class="code hl_function" href="documented_8c.html#afaab7ace51d047b5b93a42a1bc808d46">list_sessions</a>();</div>
<div class="line"><span class="lineno">  834</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(input, <span class="stringliteral">&quot;help&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  835</span>             <a class="code hl_function" href="documented_8c.html#a853216ac51aa181669ff4d3de74058a7">print_help</a>();</div>
<div class="line"><span class="lineno">  836</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(input, <span class="stringliteral">&quot;clear&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  837</span>             system(<span class="stringliteral">&quot;clear&quot;</span>);</div>
<div class="line"><span class="lineno">  838</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(input, <span class="stringliteral">&quot;kill&quot;</span>, 4) == 0) {</div>
<div class="line"><span class="lineno">  839</span>             <span class="keywordtype">int</span> id;</div>
<div class="line"><span class="lineno">  840</span>             <span class="keywordflow">if</span> (sscanf(input, <span class="stringliteral">&quot;kill %d&quot;</span>, &amp;<span class="keywordtype">id</span>) == 1) {</div>
<div class="line"><span class="lineno">  841</span>                 <a class="code hl_function" href="documented_8c.html#a938464e105c19cfe246687e5ed62e83b">kill_session</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  842</span>             } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  843</span>                 printf(<span class="stringliteral">&quot;Usage: kill &lt;id&gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  844</span>             }</div>
<div class="line"><span class="lineno">  845</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(input, <span class="stringliteral">&quot;use&quot;</span>, 3) == 0) {</div>
<div class="line"><span class="lineno">  846</span>             <span class="keywordtype">int</span> id;</div>
<div class="line"><span class="lineno">  847</span>             <span class="keywordflow">if</span> (sscanf(input, <span class="stringliteral">&quot;use %d&quot;</span>, &amp;<span class="keywordtype">id</span>) == 1) {</div>
<div class="line"><span class="lineno">  848</span>                 <a class="code hl_function" href="documented_8c.html#ae68d61c35976cb4b4e3b2a51f2ae2412">interact_session</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  849</span>             } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  850</span>                 printf(<span class="stringliteral">&quot;Usage: use &lt;id&gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  851</span>             }</div>
<div class="line"><span class="lineno">  852</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(input, <span class="stringliteral">&quot;upload&quot;</span>, 6) == 0) {</div>
<div class="line"><span class="lineno">  853</span>             <span class="keywordtype">int</span> id;</div>
<div class="line"><span class="lineno">  854</span>             <span class="keywordtype">char</span> local[128], remote[128];</div>
<div class="line"><span class="lineno">  855</span>             <span class="keywordflow">if</span> (sscanf(input, <span class="stringliteral">&quot;upload %d %127s %127s&quot;</span>, &amp;<span class="keywordtype">id</span>, local, remote) == 3) {</div>
<div class="line"><span class="lineno">  856</span>                 <a class="code hl_function" href="documented_8c.html#abf50d19801c0a1a670c979ed7414476f">upload_file</a>(<span class="keywordtype">id</span>, local, remote);</div>
<div class="line"><span class="lineno">  857</span>             } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  858</span>                 printf(<span class="stringliteral">&quot;Usage: upload &lt;id&gt; &lt;localfile&gt; &lt;remotefile&gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  859</span>             }</div>
<div class="line"><span class="lineno">  860</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(input, <span class="stringliteral">&quot;download&quot;</span>, 8) == 0) {</div>
<div class="line"><span class="lineno">  861</span>             <span class="keywordtype">int</span> id;</div>
<div class="line"><span class="lineno">  862</span>             <span class="keywordtype">char</span> remote[128], local[128];</div>
<div class="line"><span class="lineno">  863</span>             <span class="keywordflow">if</span> (sscanf(input, <span class="stringliteral">&quot;download %d %127s %127s&quot;</span>, &amp;<span class="keywordtype">id</span>, remote, local) == 3) {</div>
<div class="line"><span class="lineno">  864</span>                 <a class="code hl_function" href="documented_8c.html#aba3bf760518a9e8f99051a149aa44278">download_file</a>(<span class="keywordtype">id</span>, remote, local);</div>
<div class="line"><span class="lineno">  865</span>             } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  866</span>                 printf(<span class="stringliteral">&quot;Usage: download &lt;id&gt; &lt;remotefile&gt; &lt;localfile&gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  867</span>             }</div>
<div class="line"><span class="lineno">  868</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(input, <span class="stringliteral">&quot;upgrade&quot;</span>, 7) == 0) {</div>
<div class="line"><span class="lineno">  869</span>             <span class="keywordtype">int</span> id;</div>
<div class="line"><span class="lineno">  870</span>             <span class="keywordflow">if</span> (sscanf(input, <span class="stringliteral">&quot;upgrade %d&quot;</span>, &amp;<span class="keywordtype">id</span>) == 1) {</div>
<div class="line"><span class="lineno">  871</span>                 <a class="code hl_function" href="documented_8c.html#aa0c4fb26e646322e0ed84eaccb9abec6">upgrade</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  872</span>             } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  873</span>                 printf(<span class="stringliteral">&quot;Usage: shell &lt;id&gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  874</span>             }</div>
<div class="line"><span class="lineno">  875</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(input, <span class="stringliteral">&quot;exit&quot;</span>) == 0 || strcmp(input, <span class="stringliteral">&quot;quit&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  876</span>             printf(<span class="stringliteral">&quot;[*] Cleaning up sessions...\n&quot;</span>);</div>
<div class="line"><span class="lineno">  877</span>             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>; i++) {</div>
<div class="line"><span class="lineno">  878</span>                 kill(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].pid, SIGTERM);</div>
<div class="line"><span class="lineno">  879</span>                 waitpid(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[i].pid, NULL, WNOHANG);</div>
<div class="line"><span class="lineno">  880</span>             }</div>
<div class="line"><span class="lineno">  881</span>             printf(<span class="stringliteral">&quot;[*] Exiting...\n&quot;</span>);</div>
<div class="line"><span class="lineno">  882</span>             <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  883</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strlen(input) &gt; 0) {</div>
<div class="line"><span class="lineno">  884</span>             printf(<span class="stringliteral">&quot;[!] Unknown command: %s\n&quot;</span>, input);</div>
<div class="line"><span class="lineno">  885</span>             printf(<span class="stringliteral">&quot;[!] Use \&quot;help\&quot; to print command menu.\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  886</span>         }</div>
<div class="line"><span class="lineno">  887</span>     }</div>
<div class="line"><span class="lineno">  888</span>     <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  889</span> }</div>
<div class="ttc" id="adocumented_8c_html_a5ac8c57000bf344f575d3f3ad1dc4e9f"><div class="ttname"><a href="documented_8c.html#a5ac8c57000bf344f575d3f3ad1dc4e9f">check_sessions</a></div><div class="ttdeci">void check_sessions()</div><div class="ttdoc">Poll all sessions to detect terminated child processes.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00528">documented.c:528</a></div></div>
<div class="ttc" id="adocumented_8c_html_a63e555e101e53f240af566cf6650ac8d"><div class="ttname"><a href="documented_8c.html#a63e555e101e53f240af566cf6650ac8d">start_listener</a></div><div class="ttdeci">void start_listener(const char *port)</div><div class="ttdoc">Start a netcat listener on the specified port and register a session.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00670">documented.c:670</a></div></div>
<div class="ttc" id="adocumented_8c_html_a853216ac51aa181669ff4d3de74058a7"><div class="ttname"><a href="documented_8c.html#a853216ac51aa181669ff4d3de74058a7">print_help</a></div><div class="ttdeci">void print_help()</div><div class="ttdoc">Print the interactive help / command menu to stdout.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00161">documented.c:161</a></div></div>
<div class="ttc" id="adocumented_8c_html_a938464e105c19cfe246687e5ed62e83b"><div class="ttname"><a href="documented_8c.html#a938464e105c19cfe246687e5ed62e83b">kill_session</a></div><div class="ttdeci">void kill_session(int id)</div><div class="ttdoc">Terminate and remove a session by id.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00293">documented.c:293</a></div></div>
<div class="ttc" id="adocumented_8c_html_aa0c4fb26e646322e0ed84eaccb9abec6"><div class="ttname"><a href="documented_8c.html#aa0c4fb26e646322e0ed84eaccb9abec6">upgrade</a></div><div class="ttdeci">void upgrade(int id)</div><div class="ttdoc">Attempt to upgrade a remote shell into an interactive PTY.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00460">documented.c:460</a></div></div>
<div class="ttc" id="adocumented_8c_html_aba3bf760518a9e8f99051a149aa44278"><div class="ttname"><a href="documented_8c.html#aba3bf760518a9e8f99051a149aa44278">download_file</a></div><div class="ttdeci">void download_file(int id, const char *remote_path, const char *local_name)</div><div class="ttdoc">Request a remote file be base64-printed so the operator can download it.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00432">documented.c:432</a></div></div>
<div class="ttc" id="adocumented_8c_html_abf50d19801c0a1a670c979ed7414476f"><div class="ttname"><a href="documented_8c.html#abf50d19801c0a1a670c979ed7414476f">upload_file</a></div><div class="ttdeci">void upload_file(int id, const char *local_path, const char *remote_name)</div><div class="ttdoc">Upload a local file to a remote session by sending base64 chunks.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00375">documented.c:375</a></div></div>
<div class="ttc" id="adocumented_8c_html_ad3ba7d30d89f8d5afe4b215f0236332f"><div class="ttname"><a href="documented_8c.html#ad3ba7d30d89f8d5afe4b215f0236332f">ensure_rlwrap</a></div><div class="ttdeci">static void ensure_rlwrap(int argc, char **argv)</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00747">documented.c:747</a></div></div>
<div class="ttc" id="adocumented_8c_html_ad6da18174ed9892c214e56bac27bfc7f"><div class="ttname"><a href="documented_8c.html#ad6da18174ed9892c214e56bac27bfc7f">print_banner</a></div><div class="ttdeci">void print_banner()</div><div class="ttdoc">Print the ASCII art banner and program metadata.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00186">documented.c:186</a></div></div>
<div class="ttc" id="adocumented_8c_html_add2ae839253cf752c14f638ded505a22"><div class="ttname"><a href="documented_8c.html#add2ae839253cf752c14f638ded505a22">connect_target</a></div><div class="ttdeci">void connect_target(const char *ip, const char *port)</div><div class="ttdoc">Connect to a remote bind shell using netcat and register a session.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00713">documented.c:713</a></div></div>
<div class="ttc" id="adocumented_8c_html_ae68d61c35976cb4b4e3b2a51f2ae2412"><div class="ttname"><a href="documented_8c.html#ae68d61c35976cb4b4e3b2a51f2ae2412">interact_session</a></div><div class="ttdeci">void interact_session(int id)</div><div class="ttdoc">Interact with a session in a pseudo-terminal loop.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00564">documented.c:564</a></div></div>
<div class="ttc" id="adocumented_8c_html_afaab7ace51d047b5b93a42a1bc808d46"><div class="ttname"><a href="documented_8c.html#afaab7ace51d047b5b93a42a1bc808d46">list_sessions</a></div><div class="ttdeci">void list_sessions()</div><div class="ttdoc">Print a list of current sessions to stdout.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00267">documented.c:267</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_a3c04138a5bfe5d72780bb7e82a18e627_cgraph.svg" width="480" height="582"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad6da18174ed9892c214e56bac27bfc7f" name="ad6da18174ed9892c214e56bac27bfc7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6da18174ed9892c214e56bac27bfc7f">&#9670;&#160;</a></span>print_banner()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_banner </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print the ASCII art banner and program metadata. </p>
<p>This prints the banner, version, author and then calls <a class="el" href="documented_8c.html#a853216ac51aa181669ff4d3de74058a7" title="Print the interactive help / command menu to stdout.">print_help()</a>. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00186">186</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  186</span>                     {</div>
<div class="line"><span class="lineno">  187</span>     time_t now = time(NULL);</div>
<div class="line"><span class="lineno">  188</span>     <span class="keyword">struct </span>tm *tm_struct = localtime(&amp;now);</div>
<div class="line"><span class="lineno">  189</span>     <span class="keywordtype">char</span> datetime[64];</div>
<div class="line"><span class="lineno">  190</span>     strftime(datetime, <span class="keyword">sizeof</span>(datetime), <span class="stringliteral">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, tm_struct);</div>
<div class="line"><span class="lineno">  191</span> </div>
<div class="line"><span class="lineno">  192</span>     printf(<span class="stringliteral">&quot;\033[1;31m&quot;</span>);</div>
<div class="line"><span class="lineno">  193</span>     printf(<span class="stringliteral">&quot;████████╗██╗   ██╗██╗  ██╗███████╗\n&quot;</span>);</div>
<div class="line"><span class="lineno">  194</span>     printf(<span class="stringliteral">&quot;╚══██╔══╝██║   ██║██║ ██╔╝██╔════╝\n&quot;</span>);</div>
<div class="line"><span class="lineno">  195</span>     printf(<span class="stringliteral">&quot;   ██║   ██║   ██║█████╔╝ ███████╗\n&quot;</span>);</div>
<div class="line"><span class="lineno">  196</span>     printf(<span class="stringliteral">&quot;   ██║   ██║   ██║██╔═██╗ ╚════██║\n&quot;</span>);</div>
<div class="line"><span class="lineno">  197</span>     printf(<span class="stringliteral">&quot;   ██║   ╚██████╔╝██║  ██╗███████║\n&quot;</span>);</div>
<div class="line"><span class="lineno">  198</span>     printf(<span class="stringliteral">&quot;   ╚═╝    ╚═════╝ ╚═╝  ╚═╝╚══════╝\n&quot;</span>);</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>     printf(<span class="stringliteral">&quot;\033[1;34m&quot;</span>);</div>
<div class="line"><span class="lineno">  201</span>     printf(<span class="stringliteral">&quot;═══════════════════════════════════\n&quot;</span>);</div>
<div class="line"><span class="lineno">  202</span> </div>
<div class="line"><span class="lineno">  203</span>     printf(<span class="stringliteral">&quot;\033[1;37m&quot;</span>);</div>
<div class="line"><span class="lineno">  204</span>     printf(<span class="stringliteral">&quot;  The Ultimate Shell Manager\n&quot;</span>);</div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span>     printf(<span class="stringliteral">&quot;\033[1;34m&quot;</span>);</div>
<div class="line"><span class="lineno">  207</span>     printf(<span class="stringliteral">&quot;═══════════════════════════════════\n&quot;</span>);</div>
<div class="line"><span class="lineno">  208</span> </div>
<div class="line"><span class="lineno">  209</span>     printf(<span class="stringliteral">&quot;\033[0;36m&quot;</span>);</div>
<div class="line"><span class="lineno">  210</span>     printf(<span class="stringliteral">&quot;Version: %s\n&quot;</span>, <a class="code hl_define" href="documented_8c.html#a1c6d5de492ac61ad29aec7aa9a436bbf">VERSION</a>);</div>
<div class="line"><span class="lineno">  211</span>     printf(<span class="stringliteral">&quot;Author : %s\n&quot;</span>, <a class="code hl_define" href="documented_8c.html#a6c8fad838ed64cc67da3f68149009758">AUTHOR</a>);</div>
<div class="line"><span class="lineno">  212</span>     printf(<span class="stringliteral">&quot;GitHub: %s\n&quot;</span>, <a class="code hl_define" href="documented_8c.html#a41d49c9bf1512077295129c1406be4cd">URL</a>);</div>
<div class="line"><span class="lineno">  213</span> </div>
<div class="line"><span class="lineno">  214</span>     <a class="code hl_function" href="documented_8c.html#a853216ac51aa181669ff4d3de74058a7">print_help</a>();</div>
<div class="line"><span class="lineno">  215</span> </div>
<div class="line"><span class="lineno">  216</span>     printf(<span class="stringliteral">&quot;\033[1;34m&quot;</span>);</div>
<div class="line"><span class="lineno">  217</span>     printf(<span class="stringliteral">&quot;═══════════════════════════════════\n&quot;</span>);</div>
<div class="line"><span class="lineno">  218</span>     printf(<span class="stringliteral">&quot;\033[0m&quot;</span>);</div>
<div class="line"><span class="lineno">  219</span>     fflush(stdout);</div>
<div class="line"><span class="lineno">  220</span> }</div>
<div class="ttc" id="adocumented_8c_html_a1c6d5de492ac61ad29aec7aa9a436bbf"><div class="ttname"><a href="documented_8c.html#a1c6d5de492ac61ad29aec7aa9a436bbf">VERSION</a></div><div class="ttdeci">#define VERSION</div><div class="ttdoc">Program version string.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00038">documented.c:38</a></div></div>
<div class="ttc" id="adocumented_8c_html_a41d49c9bf1512077295129c1406be4cd"><div class="ttname"><a href="documented_8c.html#a41d49c9bf1512077295129c1406be4cd">URL</a></div><div class="ttdeci">#define URL</div><div class="ttdoc">Project repository URL.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00050">documented.c:50</a></div></div>
<div class="ttc" id="adocumented_8c_html_a6c8fad838ed64cc67da3f68149009758"><div class="ttname"><a href="documented_8c.html#a6c8fad838ed64cc67da3f68149009758">AUTHOR</a></div><div class="ttdeci">#define AUTHOR</div><div class="ttdoc">Author string used in banners.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00044">documented.c:44</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_ad6da18174ed9892c214e56bac27bfc7f_cgraph.svg" width="250" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_ad6da18174ed9892c214e56bac27bfc7f_icgraph.svg" width="218" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a853216ac51aa181669ff4d3de74058a7" name="a853216ac51aa181669ff4d3de74058a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a853216ac51aa181669ff4d3de74058a7">&#9670;&#160;</a></span>print_help()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_help </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print the interactive help / command menu to stdout. </p>
<p>This prints the top-level CLI commands and session commands available to the user. The function writes ANSI color codes for readability in terminals. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00161">161</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  161</span>                  {</div>
<div class="line"><span class="lineno">  162</span>    printf(<span class="stringliteral">&quot;\033[1;33m&quot;</span>);</div>
<div class="line"><span class="lineno">  163</span>    printf(<span class="stringliteral">&quot;\n CLI commands:\n&quot;</span>);</div>
<div class="line"><span class="lineno">  164</span>    printf(<span class="stringliteral">&quot;  listen &lt;port&gt;          - Start a reverse shell listener\n&quot;</span>);</div>
<div class="line"><span class="lineno">  165</span>    printf(<span class="stringliteral">&quot;  connect &lt;ip&gt; &lt;port&gt;    - Connect to a bind shell\n&quot;</span>);</div>
<div class="line"><span class="lineno">  166</span>    printf(<span class="stringliteral">&quot;  list                   - List all sessions\n&quot;</span>);</div>
<div class="line"><span class="lineno">  167</span>    printf(<span class="stringliteral">&quot;  use &lt;id&gt;               - Interact with a session\n&quot;</span>);</div>
<div class="line"><span class="lineno">  168</span>    printf(<span class="stringliteral">&quot;  kill &lt;id&gt;              - Terminate a session\n&quot;</span>);</div>
<div class="line"><span class="lineno">  169</span>    printf(<span class="stringliteral">&quot;  upload &lt;id&gt; &lt;local&gt; &lt;remote&gt; - Upload file\n&quot;</span>);</div>
<div class="line"><span class="lineno">  170</span>    printf(<span class="stringliteral">&quot;  upgrade &lt;id&gt;           - Upgrade interactive shell (auto pty)\n&quot;</span>);</div>
<div class="line"><span class="lineno">  171</span>    printf(<span class="stringliteral">&quot;  help                   - Command menu\n&quot;</span>);</div>
<div class="line"><span class="lineno">  172</span>    printf(<span class="stringliteral">&quot;  clear                  - Clear screen\n&quot;</span>);</div>
<div class="line"><span class="lineno">  173</span>    printf(<span class="stringliteral">&quot;  exit                   - Exit TUKS\n&quot;</span>);</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>    printf(<span class="stringliteral">&quot;\n Session commands:\n&quot;</span>);</div>
<div class="line"><span class="lineno">  176</span>    printf(<span class="stringliteral">&quot;  /BG                   - Return to menu, And send session to Background\n&quot;</span>);</div>
<div class="line"><span class="lineno">  177</span>    printf(<span class="stringliteral">&quot;\033[0m\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  178</span> }</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_a853216ac51aa181669ff4d3de74058a7_icgraph.svg" width="352" height="62"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a90c498b005e5a791ee3571c7526d6ef8" name="a90c498b005e5a791ee3571c7526d6ef8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90c498b005e5a791ee3571c7526d6ef8">&#9670;&#160;</a></span>remove_session_at_index()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void remove_session_at_index </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>idx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove and cleanup a session by array index (0-based). </p>
<p>This function attempts to terminate the child process (if running), closes any pipe file descriptors and removes the session entry from the global array, shifting remaining entries to keep the array compact.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">idx</td><td>Index into the sessions array (0-based). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00498">498</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  498</span>                                       {</div>
<div class="line"><span class="lineno">  499</span>     <span class="keywordflow">if</span> (idx &lt; 0 || idx &gt;= <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  500</span> </div>
<div class="line"><span class="lineno">  501</span>     <span class="comment">// Try to terminate child if still running</span></div>
<div class="line"><span class="lineno">  502</span>     <span class="keywordflow">if</span> (<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].pid &gt; 0) {</div>
<div class="line"><span class="lineno">  503</span>         kill(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].pid, SIGTERM);</div>
<div class="line"><span class="lineno">  504</span>         waitpid(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].pid, NULL, WNOHANG);</div>
<div class="line"><span class="lineno">  505</span>     }</div>
<div class="line"><span class="lineno">  506</span> </div>
<div class="line"><span class="lineno">  507</span>     <span class="comment">// Close pipes (ignore errors)</span></div>
<div class="line"><span class="lineno">  508</span>     <span class="keywordflow">if</span> (<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].in_pipe[0] &gt; 0) close(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].in_pipe[0]);</div>
<div class="line"><span class="lineno">  509</span>     <span class="keywordflow">if</span> (<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].in_pipe[1] &gt; 0) close(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].in_pipe[1]);</div>
<div class="line"><span class="lineno">  510</span>     <span class="keywordflow">if</span> (<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].out_pipe[0] &gt; 0) close(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].out_pipe[0]);</div>
<div class="line"><span class="lineno">  511</span>     <span class="keywordflow">if</span> (<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].out_pipe[1] &gt; 0) close(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[idx].out_pipe[1]);</div>
<div class="line"><span class="lineno">  512</span> </div>
<div class="line"><span class="lineno">  513</span>     <span class="comment">// Shift array left</span></div>
<div class="line"><span class="lineno">  514</span>     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = idx; j &lt; <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a> - 1; j++) {</div>
<div class="line"><span class="lineno">  515</span>         <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[j] = <a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[j + 1];</div>
<div class="line"><span class="lineno">  516</span>     }</div>
<div class="line"><span class="lineno">  517</span>     <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>--;</div>
<div class="line"><span class="lineno">  518</span> }</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_a90c498b005e5a791ee3571c7526d6ef8_icgraph.svg" width="480" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a63e555e101e53f240af566cf6650ac8d" name="a63e555e101e53f240af566cf6650ac8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63e555e101e53f240af566cf6650ac8d">&#9670;&#160;</a></span>start_listener()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void start_listener </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>port</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start a netcat listener on the specified port and register a session. </p>
<p>This function forks a child process that execs <code>nc -lnp &lt;port&gt;</code> and sets up two pipes for communication. The newly created session is added to the global list via <a class="el" href="documented_8c.html#aba6e2f92cbc0c6c6269dfd20063439d4" title="Add a new session to the global session list.">add_session()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">port</td><td>Port number string to listen on (as passed to nc). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00670">670</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  670</span>                                       {</div>
<div class="line"><span class="lineno">  671</span>     <span class="keywordtype">int</span> in_pipe[2];</div>
<div class="line"><span class="lineno">  672</span>     <span class="keywordtype">int</span> out_pipe[2];</div>
<div class="line"><span class="lineno">  673</span> </div>
<div class="line"><span class="lineno">  674</span>     <span class="keywordflow">if</span> (pipe(in_pipe) &lt; 0 || pipe(out_pipe) &lt; 0) {</div>
<div class="line"><span class="lineno">  675</span>         perror(<span class="stringliteral">&quot;pipe&quot;</span>);</div>
<div class="line"><span class="lineno">  676</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  677</span>     }</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span>     pid_t pid = fork();</div>
<div class="line"><span class="lineno">  680</span>     <span class="keywordflow">if</span> (pid == 0) {</div>
<div class="line"><span class="lineno">  681</span>         dup2(in_pipe[0], STDIN_FILENO);</div>
<div class="line"><span class="lineno">  682</span>         dup2(out_pipe[1], STDOUT_FILENO);</div>
<div class="line"><span class="lineno">  683</span>         dup2(out_pipe[1], STDERR_FILENO);</div>
<div class="line"><span class="lineno">  684</span> </div>
<div class="line"><span class="lineno">  685</span>         close(in_pipe[1]);</div>
<div class="line"><span class="lineno">  686</span>         close(out_pipe[0]);</div>
<div class="line"><span class="lineno">  687</span> </div>
<div class="line"><span class="lineno">  688</span>         execlp(<span class="stringliteral">&quot;nc&quot;</span>, <span class="stringliteral">&quot;nc&quot;</span>, <span class="stringliteral">&quot;-lnp&quot;</span>, port, NULL);</div>
<div class="line"><span class="lineno">  689</span>         perror(<span class="stringliteral">&quot;execlp&quot;</span>);</div>
<div class="line"><span class="lineno">  690</span>         exit(1);</div>
<div class="line"><span class="lineno">  691</span>     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pid &gt; 0) {</div>
<div class="line"><span class="lineno">  692</span>         close(in_pipe[0]);</div>
<div class="line"><span class="lineno">  693</span>         close(out_pipe[1]);</div>
<div class="line"><span class="lineno">  694</span> </div>
<div class="line"><span class="lineno">  695</span>         <span class="keywordtype">char</span> desc[128];</div>
<div class="line"><span class="lineno">  696</span>         snprintf(desc, <span class="keyword">sizeof</span>(desc), <span class="stringliteral">&quot;Listening on port %s&quot;</span>, port);</div>
<div class="line"><span class="lineno">  697</span>         <a class="code hl_function" href="documented_8c.html#aba6e2f92cbc0c6c6269dfd20063439d4">add_session</a>(pid, desc, in_pipe, out_pipe);</div>
<div class="line"><span class="lineno">  698</span>         printf(<span class="stringliteral">&quot;[*] Listener started on port %s [session %d]\n&quot;</span>, port, <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>);</div>
<div class="line"><span class="lineno">  699</span>     } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  700</span>         perror(<span class="stringliteral">&quot;fork&quot;</span>);</div>
<div class="line"><span class="lineno">  701</span>     }</div>
<div class="line"><span class="lineno">  702</span> }</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_a63e555e101e53f240af566cf6650ac8d_cgraph.svg" width="270" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_a63e555e101e53f240af566cf6650ac8d_icgraph.svg" width="222" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa0c4fb26e646322e0ed84eaccb9abec6" name="aa0c4fb26e646322e0ed84eaccb9abec6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0c4fb26e646322e0ed84eaccb9abec6">&#9670;&#160;</a></span>upgrade()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void upgrade </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Attempt to upgrade a remote shell into an interactive PTY. </p>
<p>Several methods are attempted (python3/python/<code>script</code> and fallback to /bin/bash). This sends the appropriate commands to the specified session so the remote side can spawn a PTY-backed shell and set TERM.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>1-based session id to upgrade. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00460">460</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  460</span>                      {</div>
<div class="line"><span class="lineno">  461</span>     <span class="keywordflow">if</span> (id &lt;= 0 || id &gt; <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>) {</div>
<div class="line"><span class="lineno">  462</span>         printf(<span class="stringliteral">&quot;[!] Invalid session ID\n&quot;</span>);</div>
<div class="line"><span class="lineno">  463</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  464</span>     }</div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span>     <span class="keywordtype">char</span> command[<a class="code hl_define" href="documented_8c.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>];</div>
<div class="line"><span class="lineno">  467</span>     </div>
<div class="line"><span class="lineno">  468</span>     printf(<span class="stringliteral">&quot;[*] Attempting to spawn interactive shell on session %d...\n&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  469</span>     </div>
<div class="line"><span class="lineno">  470</span>     <span class="comment">// Try multiple methods to get a proper PTY</span></div>
<div class="line"><span class="lineno">  471</span>     snprintf(command, <span class="keyword">sizeof</span>(command), </div>
<div class="line"><span class="lineno">  472</span>              <span class="stringliteral">&quot;python3 -c &#39;import pty; pty.spawn(\&quot;/bin/bash\&quot;)&#39; || &quot;</span></div>
<div class="line"><span class="lineno">  473</span>              <span class="stringliteral">&quot;python -c &#39;import pty; pty.spawn(\&quot;/bin/bash\&quot;)&#39; || &quot;</span></div>
<div class="line"><span class="lineno">  474</span>              <span class="stringliteral">&quot;script -qc /bin/bash /dev/null || &quot;</span></div>
<div class="line"><span class="lineno">  475</span>              <span class="stringliteral">&quot;/bin/bash\n&quot;</span>);</div>
<div class="line"><span class="lineno">  476</span>     </div>
<div class="line"><span class="lineno">  477</span>     write(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<span class="keywordtype">id</span> - 1].in_pipe[1], command, strlen(command));</div>
<div class="line"><span class="lineno">  478</span>     </div>
<div class="line"><span class="lineno">  479</span>     <span class="comment">// Try to set up proper terminal</span></div>
<div class="line"><span class="lineno">  480</span>     snprintf(command, <span class="keyword">sizeof</span>(command), <span class="stringliteral">&quot;export TERM=xterm\n&quot;</span>);</div>
<div class="line"><span class="lineno">  481</span>     write(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<span class="keywordtype">id</span> - 1].in_pipe[1], command, strlen(command));</div>
<div class="line"><span class="lineno">  482</span>     </div>
<div class="line"><span class="lineno">  483</span>     printf(<span class="stringliteral">&quot;[*] Interactive shell commands sent. Use &#39;use %d&#39; to interact.\n&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  484</span> }</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_aa0c4fb26e646322e0ed84eaccb9abec6_icgraph.svg" width="188" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="abf50d19801c0a1a670c979ed7414476f" name="abf50d19801c0a1a670c979ed7414476f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf50d19801c0a1a670c979ed7414476f">&#9670;&#160;</a></span>upload_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void upload_file </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>local_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>remote_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Upload a local file to a remote session by sending base64 chunks. </p>
<p>The function reads the <code>local_path</code> file in fixed-size chunks, base64 encodes each chunk and appends it to a temporary file on the remote side (named <code>uplaodtmp.tuks</code> in the remote working directory). When finished it assembles the remote file by base64-decoding the temporary file into <code>remote_name</code>.</p>
<dl class="section note"><dt>Note</dt><dd>This function assumes the remote end runs a POSIX shell and has <code>base64</code> available. The temporary filename is fixed and may collide with other concurrent uploads on the remote host.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>1-based session id to which data should be uploaded. </td></tr>
    <tr><td class="paramname">local_path</td><td>Path to the local file to send. </td></tr>
    <tr><td class="paramname">remote_name</td><td>Destination path/name on the remote filesystem. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00375">375</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  375</span>                                                                           {</div>
<div class="line"><span class="lineno">  376</span>   <span class="keywordflow">if</span> (id &lt;= 0 || id &gt; <a class="code hl_variable" href="documented_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>) {</div>
<div class="line"><span class="lineno">  377</span>       printf(<span class="stringliteral">&quot;[!] Invalid session ID\n&quot;</span>);</div>
<div class="line"><span class="lineno">  378</span>       <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  379</span>   }</div>
<div class="line"><span class="lineno">  380</span> </div>
<div class="line"><span class="lineno">  381</span>   FILE *fp = fopen(local_path, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><span class="lineno">  382</span>   <span class="keywordflow">if</span> (!fp) {</div>
<div class="line"><span class="lineno">  383</span>       perror(<span class="stringliteral">&quot;fopen&quot;</span>);</div>
<div class="line"><span class="lineno">  384</span>       <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  385</span>   }</div>
<div class="line"><span class="lineno">  386</span> </div>
<div class="line"><span class="lineno">  387</span>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buffer[512];</div>
<div class="line"><span class="lineno">  388</span>   <span class="keywordtype">size_t</span> n;</div>
<div class="line"><span class="lineno">  389</span>   <span class="keywordtype">char</span> command[<a class="code hl_define" href="documented_8c.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>];</div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>   snprintf(command, <span class="keyword">sizeof</span>(command), <span class="stringliteral">&quot;rm -f uplaodtmp.tuks\n&quot;</span>);</div>
<div class="line"><span class="lineno">  392</span>   write(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<span class="keywordtype">id</span> - 1].in_pipe[1], command, strlen(command));</div>
<div class="line"><span class="lineno">  393</span> </div>
<div class="line"><span class="lineno">  394</span>   <span class="keywordflow">while</span> ((n = fread(buffer, 1, <span class="keyword">sizeof</span>(buffer), fp)) &gt; 0) {</div>
<div class="line"><span class="lineno">  395</span>       <span class="keywordtype">size_t</span> out_len;</div>
<div class="line"><span class="lineno">  396</span>       <span class="keywordtype">char</span> *encoded = <a class="code hl_function" href="documented_8c.html#ac653f5b6dfa7a11107cdcc4e6b8c721c">base64_encode</a>(buffer, n, &amp;out_len);</div>
<div class="line"><span class="lineno">  397</span>       <span class="keywordflow">if</span> (!encoded) {</div>
<div class="line"><span class="lineno">  398</span>           printf(<span class="stringliteral">&quot;[!] base64_encode failed\n&quot;</span>);</div>
<div class="line"><span class="lineno">  399</span>           fclose(fp);</div>
<div class="line"><span class="lineno">  400</span>           <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  401</span>       }</div>
<div class="line"><span class="lineno">  402</span> </div>
<div class="line"><span class="lineno">  403</span>       snprintf(command, <span class="keyword">sizeof</span>(command), <span class="stringliteral">&quot;echo \&quot;%s\&quot; &gt;&gt; uplaodtmp.tuks\n&quot;</span>,</div>
<div class="line"><span class="lineno">  404</span>                encoded);</div>
<div class="line"><span class="lineno">  405</span>       write(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<span class="keywordtype">id</span> - 1].in_pipe[1], command, strlen(command));</div>
<div class="line"><span class="lineno">  406</span>       free(encoded);</div>
<div class="line"><span class="lineno">  407</span>   }</div>
<div class="line"><span class="lineno">  408</span> </div>
<div class="line"><span class="lineno">  409</span>   fclose(fp);</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>   snprintf(command, <span class="keyword">sizeof</span>(command),</div>
<div class="line"><span class="lineno">  412</span>            <span class="stringliteral">&quot;cat uplaodtmp.tuks | base64 -d &gt; %s\n&quot;</span>, remote_name);</div>
<div class="line"><span class="lineno">  413</span>   write(<a class="code hl_variable" href="documented_8c.html#a2b2b503f5b2275d94e6607251bd90bd5">sessions</a>[<span class="keywordtype">id</span> - 1].in_pipe[1], command, strlen(command));</div>
<div class="line"><span class="lineno">  414</span> </div>
<div class="line"><span class="lineno">  415</span>   printf(<span class="stringliteral">&quot;[*] File %s uploaded to session %d as %s\n&quot;</span>, local_path, <span class="keywordtype">id</span>,</div>
<div class="line"><span class="lineno">  416</span>          remote_name);</div>
<div class="line"><span class="lineno">  417</span> }</div>
<div class="ttc" id="adocumented_8c_html_ac653f5b6dfa7a11107cdcc4e6b8c721c"><div class="ttname"><a href="documented_8c.html#ac653f5b6dfa7a11107cdcc4e6b8c721c">base64_encode</a></div><div class="ttdeci">char * base64_encode(const unsigned char *src, size_t len, size_t *out_len)</div><div class="ttdoc">Encode a buffer into base64.</div><div class="ttdef"><b>Definition</b> <a href="documented_8c_source.html#l00114">documented.c:114</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_abf50d19801c0a1a670c979ed7414476f_cgraph.svg" width="275" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="documented_8c_abf50d19801c0a1a670c979ed7414476f_icgraph.svg" width="207" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="abfb7807bca1894b8f5eda68986aac98d" name="abfb7807bca1894b8f5eda68986aac98d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfb7807bca1894b8f5eda68986aac98d">&#9670;&#160;</a></span>b64_table</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char b64_table[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=</div>
<div class="line">     <span class="stringliteral">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></div>
</div><!-- fragment -->
<p>Base64 translation table used by <a class="el" href="documented_8c.html#ac653f5b6dfa7a11107cdcc4e6b8c721c" title="Encode a buffer into base64.">base64_encode()</a>. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00097">97</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>

</div>
</div>
<a id="a7aa5af3eb4d501b0c44c590507f751e8" name="a7aa5af3eb4d501b0c44c590507f751e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7aa5af3eb4d501b0c44c590507f751e8">&#9670;&#160;</a></span>session_count</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int session_count = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Current number of sessions in <code>sessions</code>. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00091">91</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>

</div>
</div>
<a id="a2b2b503f5b2275d94e6607251bd90bd5" name="a2b2b503f5b2275d94e6607251bd90bd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b2b503f5b2275d94e6607251bd90bd5">&#9670;&#160;</a></span>sessions</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structSession.html">Session</a> sessions[<a class="el" href="documented_8c.html#ad3ef68d2292999ee3beb635427a515ef">MAX_SESSIONS</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Global array storing active sessions. </p>

<p class="definition">Definition at line <a class="el" href="documented_8c_source.html#l00086">86</a> of file <a class="el" href="documented_8c_source.html">documented.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
